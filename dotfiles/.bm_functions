# Usage:
#   docker_alias_completion_wrapper <completion function> <alias/function name>
#
# Example:
#   dock-ip() { docker inspect --format '{{ .NetworkSettings.IPAddress }}' $@ ;}
#   docker_alias_completion_wrapper __docker_complete_containers_running dock-ip
function docker_alias_completion_wrapper {
  local completion_function="$1";
  local alias_name="$2";

  local func=$(cat <<EOT
    # Generate a new completion function name
    function _$alias_name() {
        # Start off like _docker()
        local previous_extglob_setting=\$(shopt -p extglob);
        shopt -s extglob;

        # Populate \$cur, \$prev, \$words, \$cword
        _get_comp_words_by_ref -n : cur prev words cword;

        # Declare and execute
        declare -F $completion_function >/dev/null && $completion_function;

        eval "\$previous_extglob_setting";
        return 0;
    };
EOT
  );
  eval "$func";

  # Register the alias completion function
  complete -F _$alias_name $alias_name
}
export -f docker_alias_completion_wrapper

function mkdr() {
	mkdir -p "$@" && cd "$_";
}

function apti() {
	sudo apt-get install $@ -y
}

function dexec(){
	complete -F _docker exec -ti $@ sh	
}
docker_alias_completion_wrapper __docker_complete_containers_all dexec

function fdrun() {
	if [ "$HOSTNAME" = docker ]; then
		echo && echo "----  docker1: www & doc content  ---------------------------------------------------------------------" && echo && cd /tmp && rm -rf /tmp/docker && git clone git@github.com:bmilcs/docker.git /tmp/docker && cd /tmp/docker && rm -f ~/docker/docker-compose.yaml ~/docker/.env && cp 1docker-compose.yaml .env ~/docker/ && cd ~/dockerl && mv 1docker-compose.yaml docker-compose.yaml && docker-compose up -d --remove-orphans
	elif [ "$HOSTNAME" = docker2 ]; then
		echo && echo "----  docker2: linux iso  -----------------------------------------------------------------------------" && echo && cd /tmp && rm -rf /tmp/docker && git clone git@github.com:bmilcs/docker.git /tmp/docker && cd /tmp/docker && rm -f ~/docker/docker-compose.yaml ~/docker/.env && cp 1docker-compose.yaml .env ~/docker/ && cd ~/dockerl && mv 1docker-compose.yaml docker-compose.yaml && docker-compose up -d --remove-orphans
	else
		echo "error: wrong vm dummy!"
	fi
}

function aptr() {
	sudo apt-get purge $@ -y
}

function aptf() {
	dpkg --get-selections | grep $@
}

function apts() {	systemctl status $@re; }


function myip() {
	printf "\n%s" "          host:   "
	echo $HOSTNAME "(.bm.bmilcs.com)"
	ipp="ip a | sed -En 's/127.0.0.1//;s/.*inet (addr:)?(([0-9]*\.){3}[0-9]*).*/\2/p'"
	eval ip=\$\($ipp\)
	printf "%s" "           lan:   " 
	echo $ip 
	eval wan=\$\(dig @1.1.1.1 ch txt whoami.cloudflare +short\)
	wan="${wan%\"}"
	wan="${wan#\"}"
	printf "%s\n\n" "           wan:   $wan " 
}

function ddel() {
	docker stop $(docker ps -a -q)
	docker rm $(docker ps -a -q)
}

function dlog () {
	docker logs -f $@
}
